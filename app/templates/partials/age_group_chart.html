{# Age group distribution chart - subscribes to MosaicState for cross-filtering #}

<script type="application/json" id="age-group-data">{{ chart_data | tojson }}</script>

<div class="card bg-base-100 shadow-xl">
    <div class="card-body">
        <h3 class="card-title">Cases by Age Group</h3>

        <div id="age-group-chart" style="min-height: 450px;"></div>
    </div>
</div>

<script>
(function() {
    // Parse embedded JSON
    const dataEl = document.getElementById('age-group-data');
    if (!dataEl) return;

    const chartData = JSON.parse(dataEl.textContent);
    if (!chartData || !chartData.states) {
        console.warn('No age group data available');
        return;
    }

    const diseaseName = '{{ disease_name }}';

    // Render function
    function updateUI(selectedStates) {
        // Convert Set to Array for the chart function
        const statesArray = Array.from(selectedStates);
        const svg = createAgeGroupChart(chartData, diseaseName, statesArray);
        document.getElementById('age-group-chart').replaceChildren(svg);
    }

    // Subscribe to MosaicState for selection changes
    window.MosaicState.subscribeToStateSelection(updateUI);
})();
</script>
