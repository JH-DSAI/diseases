{# Time series chart by state - DC.js with crossfilter #}

<style>
/* Fix DC.js series chart to render as lines, not filled areas */
#state-trend-chart .chart-body path.line {
    fill: none !important;
    stroke-width: 2px;
}
#state-trend-chart .chart-body path.area {
    display: none !important;
}
</style>

<script type="application/json" id="timeseries-data">{{ chart_data | tojson }}</script>

<div class="card bg-base-100 shadow-xl">
    <div class="card-body">
        <div class="flex items-center justify-between mb-4">
            <h3 class="card-title">Cases Over Time by State</h3>
        </div>

        <p class="text-sm text-base-content/70 mb-4">
            Click states on the left to filter. Shift+click for multi-select.
        </p>

        <div class="flex gap-4 overflow-hidden">
            <!-- State filter (DC row chart) -->
            <div class="shrink-0" style="width: 180px;">
                <button id="reset-state-filter" class="btn btn-xs btn-ghost mb-2">Reset Filters</button>
                <div id="state-filter" class="overflow-y-auto" style="max-height: 350px;"></div>
            </div>

            <!-- Main series chart -->
            <div id="state-trend-chart" class="flex-1 overflow-hidden"></div>
        </div>
    </div>
</div>

<script>
(function() {
    const dataEl = document.getElementById('timeseries-data');
    if (!dataEl) return;

    const data = JSON.parse(dataEl.textContent);
    if (!data || !data.states) {
        console.warn('No timeseries data available');
        return;
    }

    // Initialize DC.js charts
    const charts = createDCStateTrendChart(
        data,
        '#state-trend-chart',
        '#state-filter'
    );

    // Reset button
    const resetBtn = document.getElementById('reset-state-filter');
    if (resetBtn && charts) {
        resetBtn.addEventListener('click', () => {
            charts.reset();
        });
    }
})();
</script>
