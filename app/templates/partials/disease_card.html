{# Single disease card with mini chart #}
<a href="/disease/{{ disease.slug }}"
   class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow cursor-pointer">
    <div class="card-body">
        <h3 class="card-title capitalize">{{ disease.name }}</h3>
        <div id="chart-{{ disease.slug }}" class="w-full" style="min-height: 205px;">
            <div class="flex items-center justify-center h-48">
                <span class="loading loading-spinner loading-md"></span>
            </div>
        </div>
        <div class="mt-4 text-center">
            <div class="text-sm text-base-content/70">Cumulative Total</div>
            <div class="text-2xl font-bold text-primary">
                {% if disease.total_cases is not none %}
                    {{ "{:,}".format(disease.total_cases) }}
                {% else %}
                    -
                {% endif %}
            </div>
        </div>
    </div>
</a>
<script>
(function() {
    // Use API.getHeaders() for auth - falls back to cookie auth if no localStorage key
    const headers = typeof API !== 'undefined' ? API.getHeaders() : {};

    fetch('/api/data/timeseries/national/{{ disease.slug }}', { headers })
    .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
    })
    .then(data => {
        if (data && data.data) {
            createNationalDiseaseTrendChart('chart-{{ disease.slug }}', data.data, data.disease_name);
        } else {
            createNationalDiseaseTrendChart('chart-{{ disease.slug }}', [], '{{ disease.name }}');
        }
    })
    .catch(err => {
        console.error('Failed to fetch timeseries for {{ disease.slug }}:', err);
        createNationalDiseaseTrendChart('chart-{{ disease.slug }}', [], '{{ disease.name }}');
    });
})();
</script>
