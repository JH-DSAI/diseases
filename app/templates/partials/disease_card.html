{# Single disease card with mini chart #}
<a href="/disease/{{ disease.slug }}"
   class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow cursor-pointer">
    <div class="card-body">
        <div class="flex items-center justify-between">
            <h3 class="card-title capitalize">{{ disease.name }}</h3>
            {% if disease.data_source %}
            <div class="flex gap-1">
                {% for source in disease.data_source.split(',') %}
                <span class="badge badge-sm {% if source == 'nndss' %}badge-primary{% else %}badge-secondary{% endif %}">
                    {{ source.upper() }}
                </span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div x-data="diseaseCard('{{ disease.slug }}', '{{ disease.name }}')" x-init="load()">
            <div x-ref="chart" class="w-full" style="min-height: 205px;">
                <div class="flex items-center justify-center h-48">
                    <span class="loading loading-spinner loading-md"></span>
                </div>
            </div>
        </div>
        <div class="mt-4 text-center">
            <div class="text-sm text-base-content/70">Cumulative Total</div>
            <div class="text-2xl font-bold text-primary">
                {% if disease.total_cases is not none %}
                    {{ "{:,}".format(disease.total_cases) }}
                {% else %}
                    -
                {% endif %}
            </div>
        </div>
    </div>
</a>
<script>
function diseaseCard(slug, name) {
    return {
        async load() {
            try {
                const res = await fetch(`/api/data/timeseries/national/${slug}`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                const svg = createNationalTrendChart(data.data || [], name);
                this.$refs.chart.replaceChildren(svg);
            } catch (err) {
                console.error(`Failed to fetch timeseries for ${slug}:`, err);
                const svg = createNationalTrendChart([], name);
                this.$refs.chart.replaceChildren(svg);
            }
        }
    }
}
</script>
