{% extends "base.html" %}

{% block content %}
<!-- Hero Section -->
<article class="prose lg:prose-xl mx-auto mb-8">
    <h1>Welcome to Our Platform</h1>
    <p>
        This is an example of beautiful typography using Tailwind's prose classes.
        The prose utility provides sensible typographic defaults for your content,
        making it easy to create readable and visually appealing text without custom styling.
    </p>
    <p>
        You can replace this placeholder content with your own text. The typography will
        automatically scale responsively, ensuring your content looks great on all devices
        from mobile phones to large desktop displays.
    </p>
</article>

<!-- Disease Cards -->
{% if diseases %}
<div class="mb-8">
    <h2 class="text-3xl font-bold mb-6">Tracked Diseases</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for disease in diseases %}
        <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
            <div class="card-body">
                <h3 class="card-title capitalize">{{ disease }}</h3>
                <p class="text-sm text-base-content/70">
                    View detailed statistics and visualizations for {{ disease }}.
                </p>
                <div class="card-actions justify-end mt-4">
                    <a href="/disease/{{ disease }}" class="btn btn-primary btn-sm">
                        View Details
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="alert alert-info">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <span>No disease data loaded. Please check the data directory.</span>
</div>
{% endif %}

<!-- Stats Overview -->
<div class="mb-8">
    <h2 class="text-3xl font-bold mb-6">National Overview</h2>
    <div class="stats stats-vertical lg:stats-horizontal shadow w-full"
         x-data="{ stats: {} }"
         x-init="fetch('/api/stats', {
                     headers: {
                         'Authorization': 'Bearer ' + (localStorage.getItem('api_key') || '')
                     }
                 })
                 .then(r => r.json())
                 .then(data => stats = data)
                 .catch(err => console.error('Failed to fetch stats:', err))">

        <template x-if="stats.disease_totals && stats.disease_totals.length > 0">
            <template x-for="disease in stats.disease_totals" :key="disease.disease_name">
                <div class="stat">
                    <div class="stat-title capitalize" x-text="disease.disease_name + ' Cases'"></div>
                    <div class="stat-value text-primary" x-text="disease.total_cases.toLocaleString()">-</div>
                    <div class="stat-desc">Total for all states with data</div>
                </div>
            </template>
        </template>

        <template x-if="stats.disease_totals && stats.disease_totals.length > 0">
            <div class="stat">
                <div class="stat-title">Last Updated</div>
                <div class="stat-value text-secondary" x-text="stats.latest_date ? new Date(stats.latest_date).toLocaleDateString() : '-'">-</div>
                <div class="stat-desc">Most recent data from CSVs</div>
            </div>
        </template>

        <template x-if="!stats.disease_totals || stats.disease_totals.length === 0">
            <div class="stat">
                <div class="stat-title">No Data</div>
                <div class="stat-value">-</div>
                <div class="stat-desc">Loading...</div>
            </div>
        </template>
    </div>
</div>

<!-- National Disease Trends -->
{% if diseases %}
<div class="mb-8">
    <h2 class="text-3xl font-bold mb-6">National Disease Trends</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for disease in diseases %}
        <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow cursor-pointer"
             x-data="{ chartData: null, error: null }"
             x-init="fetch('/api/timeseries/national/{{ disease }}', {
                         headers: {
                             'Authorization': 'Bearer ' + (localStorage.getItem('api_key') || '')
                         }
                     })
                     .then(r => {
                         if (!r.ok) {
                             throw new Error(`HTTP ${r.status}: ${r.statusText}`);
                         }
                         return r.json();
                     })
                     .then(data => {
                         console.log('Timeseries data for {{ disease }}:', data);
                         chartData = data;
                         if (data && data.data) {
                             createNationalDiseaseTrendChart('chart-{{ disease | replace(' ', '-') }}', data.data, data.disease_name);
                         } else {
                             createNationalDiseaseTrendChart('chart-{{ disease | replace(' ', '-') }}', [], '{{ disease }}');
                         }
                     })
                     .catch(err => {
                         console.error('Failed to fetch timeseries for {{ disease }}:', err);
                         error = err.message;
                         createNationalDiseaseTrendChart('chart-{{ disease | replace(' ', '-') }}', [], '{{ disease }}');
                     })"
             onclick="window.location.href='/disease/{{ disease }}'">
            <div class="card-body">
                <h3 class="card-title capitalize">{{ disease }}</h3>
                <div id="chart-{{ disease | replace(' ', '-') }}" class="w-full" style="min-height: 200px;">
                    <div class="flex items-center justify-center h-48">
                        <span class="loading loading-spinner loading-md"></span>
                    </div>
                </div>
                <div class="card-actions justify-end mt-2">
                    <div class="badge badge-outline">Click to view details</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Placeholder for Future Visualizations -->
<div class="mt-12">
    <h2 class="text-3xl font-bold mb-6">Data Visualizations</h2>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Placeholder 1: Temporal Trends -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h3 class="card-title">Temporal Trends</h3>
                <div class="h-64 flex items-center justify-center bg-base-200 rounded">
                    <p class="text-base-content/50">Coming soon: Time series visualization</p>
                </div>
            </div>
        </div>

        <!-- Placeholder 2: Geographic Distribution -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h3 class="card-title">Geographic Distribution</h3>
                <div class="h-64 flex items-center justify-center bg-base-200 rounded">
                    <p class="text-base-content/50">Coming soon: Map visualization</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/national-disease-trend-chart.js"></script>
{% endblock %}
